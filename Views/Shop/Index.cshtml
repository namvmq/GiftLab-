@model GiftLab.ViewModels.ShopIndexViewModel

@{
    ViewData["Title"] = "Cửa hàng";
}

<link rel="stylesheet" href="~/css/shop.css" />

<section class="gl-shop">
    <div class="gl-shop-layout">

        <form method="get" asp-action="Index">
            <aside class="gl-filter">
                <h3 class="gl-filter-title">Danh mục sản phẩm</h3>

                @foreach (var cat in Model.Categories)
                {
                    <label class="gl-check">
                        <input type="checkbox"
                               name="catIds"
                               value="@cat.Id"
                        @(Model.SelectedCategoryIds.Contains(cat.Id) ? "checked" : "") />
                        <span class="gl-box"></span>
                        <span class="gl-check-text">@cat.Name</span>
                    </label>
                }

                <hr class="gl-filter-line" />

                <h3 class="gl-filter-title">Giá sản phẩm</h3>

                <input class="gl-range"
                       type="range"
                       min="0"
                       max="200000"
                       step="1000"
                       name="maxPrice"
                       value="@Model.MaxPrice"
                       oninput="priceVal.innerText = this.value.replace(/\B(?=(\d{3})+(?!\d))/g,'.') + ' đ'" />

                <div class="gl-price-value">
                    Giá: <span id="priceVal">@Model.MaxPrice.ToString("N0") đ</span>
                </div>

                <button type="submit" class="gl-filter-btn">Lọc sản phẩm</button>
            </aside>
        </form>


        <div class="gl-shop-main">
            <h1 class="gl-shop-title">Cửa hàng</h1>

            <div class="gl-shop-grid">
                @foreach (var p in Model.Products)
                {
                @await Html.PartialAsync("_ProductCard", p)
                }
            </div>

            @if (Model.TotalPages > 1)
            {
            <div class="gl-shop-paging">
                @{
                var prevPage = Model.Page - 1;
                var nextPage = Model.Page + 1;

                var prevUrl = Url.Action("Index", "Shop", new { page = prevPage });
                var nextUrl = Url.Action("Index", "Shop", new { page = nextPage });
                }

                    <a class="gl-page-btn"
                       asp-action="Index"
                       asp-route-page="@(Model.Page - 1)"
                       asp-route-maxPrice="@Model.MaxPrice"
                       asp-route-catIds="@Model.SelectedCategoryIds">
                        ‹ Trước
                    </a>


                <span class="gl-page-info">Trang @Model.Page / @Model.TotalPages</span>

                <a class="gl-page-btn @(Model.Page >= Model.TotalPages ? " is-disabled" : "" )"
                   href="@(Model.Page >= Model.TotalPages ? " #" : nextUrl)">
                    Sau ›
                </a>
            </div>
            }
        </div>

    </div>
</section>